{# 
    PARTIAL: Error Handling Standardizzato
    
    Tipi di errori:
    - form_errors: errori di validazione form
    - system_error: errori di sistema/server
    - warning: avvisi per l'utente
    - info: informazioni utili
    
    Parametri:
    - error_type: tipo di errore
    - title: titolo dell'errore
    - message: messaggio principale
    - details: dettagli aggiuntivi (lista)
    - actions: azioni suggerite (lista di dict con text e url)
    - dismissible: se l'errore pu√≤ essere chiuso
    
    Utilizzo:
    {{ render_error_alert("form_errors", "Errori di validazione", form_errors, actions=[{"text": "Riprova", "url": "#"}]) }}
#}

{% macro render_error_alert(error_type="info", title=None, message=None, details=None, actions=None, dismissible=True) %}
    {% set alert_class = {
        'form_errors': 'alert-warning',
        'system_error': 'alert-danger', 
        'warning': 'alert-warning',
        'info': 'alert-info',
        'success': 'alert-success'
    } %}
    
    {% set icon_class = {
        'form_errors': 'fas fa-exclamation-triangle',
        'system_error': 'fas fa-times-circle',
        'warning': 'fas fa-exclamation-triangle', 
        'info': 'fas fa-info-circle',
        'success': 'fas fa-check-circle'
    } %}
    
    <div class="alert {{ alert_class[error_type] or 'alert-info' }} {{ 'alert-dismissible fade show' if dismissible else '' }}" role="alert">
        <div class="d-flex">
            <div class="me-3">
                <i class="{{ icon_class[error_type] or 'fas fa-info-circle' }} fs-4"></i>
            </div>
            <div class="flex-grow-1">
                {% if title %}
                    <h6 class="alert-heading">{{ title }}</h6>
                {% endif %}
                
                {% if message %}
                    <p class="mb-2">{{ message }}</p>
                {% endif %}
                
                {% if details %}
                    <ul class="mb-2">
                        {% for detail in details %}
                            <li>{{ detail }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                
                {% if actions %}
                    <div class="mt-3">
                        {% for action in actions %}
                            <a href="{{ action.url }}" class="btn btn-sm {{ action.class or 'btn-outline-secondary' }} me-2">
                                {% if action.icon %}
                                    <i class="{{ action.icon }} me-1"></i>
                                {% endif %}
                                {{ action.text }}
                            </a>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            {% if dismissible %}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            {% endif %}\n        </div>
    </div>
{% endmacro %}

{# 
    MACRO per errori di form automatizzati
#}
{% macro render_form_errors(form) %}
    {% if form.errors %}
        {% set error_list = [] %}
        {% for field_name, field_errors in form.errors.items() %}
            {% for error in field_errors %}
                {% if field_name != 'csrf_token' %}
                    {% set _ = error_list.append(form[field_name].label.text ~ ": " ~ error) %}
                {% endif %}
            {% endfor %}
        {% endfor %}
        
        {% if error_list %}
            {{ render_error_alert(
                "form_errors", 
                "Errori di validazione", 
                "Correggi i seguenti errori prima di continuare:",
                error_list,
                dismissible=False
            ) }}
        {% endif %}
    {% endif %}
{% endmacro %}{# 
    MACRO per messaggi flash standardizzati
#}
{% macro render_flash_messages() %}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                {% set flash_type = {
                    'error': 'system_error',
                    'danger': 'system_error', 
                    'warning': 'warning',
                    'info': 'info',
                    'success': 'success'
                }[category] or 'info' %}
                
                {{ render_error_alert(flash_type, message=message) }}
            {% endfor %}
        {% endif %}
    {% endwith %}
{% endmacro %}