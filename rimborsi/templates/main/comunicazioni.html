{% extends 'base.html' %}

{% block title %}Storico Comunicazioni{% endblock %}

{% block content %}
<style>
/* Stili Bootstrap essenziali per la pagina */
.container { width: 100%; padding-right: 15px; padding-left: 15px; margin-right: auto; margin-left: auto; }
.py-4 { padding-top: 1.5rem !important; padding-bottom: 1.5rem !important; }
.mb-4 { margin-bottom: 1.5rem !important; }
.mb-0 { margin-bottom: 0 !important; }
.d-flex { display: flex !important; }
.justify-content-between { justify-content: space-between !important; }
.align-items-center { align-items: center !important; }
.btn { display: inline-block; font-weight: 400; text-align: center; vertical-align: middle; user-select: none; border: 1px solid transparent; padding: 0.375rem 0.75rem; font-size: 1rem; line-height: 1.5; border-radius: 0.25rem; transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out; }
.btn-secondary { color: #fff; background-color: #6c757d; border-color: #6c757d; }
.me-1 { margin-right: 0.25rem !important; }
.card { position: relative; display: flex; flex-direction: column; min-width: 0; word-wrap: break-word; background-color: #fff; background-clip: border-box; border: 1px solid rgba(0, 0, 0, 0.125); border-radius: 0.25rem; }
.shadow-sm { box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075) !important; }
.card-header { padding: 0.75rem 1.25rem; margin-bottom: 0; background-color: rgba(0, 0, 0, 0.03); border-bottom: 1px solid rgba(0, 0, 0, 0.125); }
.bg-light { background-color: #f8f9fa !important; }
.card-body { flex: 1 1 auto; min-height: 1px; padding: 1.25rem; }
.p-0 { padding: 0 !important; }
h1, h5 { margin-top: 0; font-weight: 500; line-height: 1.2; }
h1 { font-size: 2.5rem; }
h5 { font-size: 1.25rem; }

/* Stili per la tabella */
.table-responsive { display: block; width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; }
.table { width: 100%; margin-bottom: 1rem; color: #212529; border-collapse: collapse; }
.table th, .table td { padding: 0.75rem; vertical-align: top; border-top: 1px solid #dee2e6; }
.table thead th { vertical-align: bottom; border-bottom: 2px solid #dee2e6; }
.table tbody + tbody { border-top: 2px solid #dee2e6; }
.table-striped tbody tr:nth-of-type(odd) { background-color: rgba(0, 0, 0, 0.05); }
.table-hover tbody tr:hover { background-color: rgba(0, 0, 0, 0.075); }
.text-center { text-align: center !important; }
</style>

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">Storico Comunicazioni</h1>
        <div>
            {% if view_from == "istruttoria" %}
                <a href="{{ url_for('istruttoria.dettaglio_istruttoria', richiesta_id=richiesta.id) }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i> Torna al Dettaglio Istruttoria
                </a>
            {% else %}
                <a href="{{ url_for('richiesta.dettaglio_richiesta', richiesta_id=richiesta.id) }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i> Torna al Dettaglio Richiesta
                </a>
            {% endif %}
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-light">
            <h5 class="mb-0">Richiesta: {{ richiesta.protocollo_invio or "Non ancora trasmessa" }}</h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead class="thead-light">
                        <tr>
                            <th>Data</th>
                            <th>Protocollo</th>
                            <th>Stato Precedente</th>
                            <th>Stato Successivo</th>
                            <th>Descrizione</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for comunicazione in comunicazioni %}
                        <tr>
                            <td>{{ comunicazione.data_transazione.strftime('%d/%m/%Y %H:%M') }}</td>
                            <td>{{ comunicazione.protocollo }}</td>
                            <td>{{ comunicazione.stato_precedente }}</td>
                            <td>{{ comunicazione.stato_successore }}</td>
                            <td>{{ comunicazione.descrizione }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="text-center">Nessuna comunicazione presente</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}