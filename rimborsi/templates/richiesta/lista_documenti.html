{% extends 'base.html' %}
{% block title %}Gestione Documenti{% endblock %}

{% block content %}
    <div class="mb-4">
        <h1 class="mb-0">Gestione Documenti</h1>
        <p class="lead text-muted">Per la spesa: "{{ spesa.descrizione_spesa }}" di € {{ "%.2f"|format(spesa.importo_richiesto) }}</p>
        <div class="alert alert-info">DEBUG: richiesta.stato = {{ richiesta.stato }}</div>
    </div>

    <div class="row g-4">
        {# Colonna con il form per aggiungere un nuovo documento #}
        {% include 'partials/_form_aggiungi_documento.html' %}

        {# Colonna con la lista dei documenti già caricati #}
        {% include 'partials/_lista_documenti_caricati.html' %}
    </div>
    
    {# Link per tornare alla pagina di dettaglio #}
    {% include 'partials/_link_torna_dettaglio.html' %}

    {# Modale per la fotocamera #}
    {% include 'partials/_modal_camera.html' %}
{% endblock %}

{% block scripts %}
    {{ super() if super }} {# Mantiene gli script del template base, se presenti #}
    <script src="{{ url_for('static', filename='js/camera.js') }}"></script>

    {# Lo script per la logica del form rimane qui, nel template principale,
       perché deve poter controllare gli elementi del form. #}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tipoDocumentoSelect = document.getElementById('tipo_documento');
            const importoContainer = document.getElementById('importo-container');
            const importoInput = document.getElementById('importo_documento');
            const tipiSenzaImporto = ['C', 'D'];

            function toggleImportoField() {
                if (!tipoDocumentoSelect || !importoContainer || !importoInput) {
                    console.error("Elementi del form non trovati. Controlla gli id.");
                    return;
                }
                const valoreSelezionato = tipoDocumentoSelect.value;
                if (tipiSenzaImporto.includes(valoreSelezionato)) {
                    importoContainer.style.display = 'none';
                    importoInput.value = '0.00'; // imposta sempre 0.00
                } else {
                    importoContainer.style.display = 'block';
                    importoInput.value = '';
                }
            }

            tipoDocumentoSelect.addEventListener('change', toggleImportoField);
            toggleImportoField();
        });
    </script>
{% endblock %}